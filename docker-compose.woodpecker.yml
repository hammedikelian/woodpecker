services:
  woodpecker-server:
    image: woodpeckerci/woodpecker-server:v3.13.0
    container_name: woodpecker-server
    ports:
      - "8000:8000"   # Interface web
      - "9000:9000"   # gRPC pour les agents
    volumes:
      - woodpecker-server-data:/var/lib/woodpecker/
    environment:
      # URL publique du serveur Woodpecker (via ngrok)
      - WOODPECKER_HOST=https://nonostensive-uncombable-nora.ngrok-free.dev
      - WOODPECKER_OPEN=true

      # Configuration GitHub OAuth
      - WOODPECKER_GITHUB=true
      - WOODPECKER_GITHUB_CLIENT=${GITHUB_CLIENT_ID}
      - WOODPECKER_GITHUB_SECRET=${GITHUB_CLIENT_SECRET}

      # Secret partag√© entre server et agent
      - WOODPECKER_AGENT_SECRET=${WOODPECKER_AGENT_SECRET}

      # Admin (ton username GitHub)
      - WOODPECKER_ADMIN=${GITHUB_ADMIN_USER}

volumes:
  woodpecker-server-data:
